<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>InkPages</title>
  <link rel="stylesheet" href="reader.css">
</head>
<body>
  <!-- Header Bar - Minimal like Safari Reader -->
  <header id="reader-header">
    <div class="header-left">
      <button id="btn-close" class="header-btn" title="Close Reader (Esc)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
      <span id="site-name" class="site-name"></span>
    </div>

    <div class="header-center">
      <span id="compact-title" class="compact-title"></span>
      <span id="page-indicator" class="page-indicator">1 / 1</span>
    </div>

    <div class="header-right">
      <button id="btn-export" class="header-btn" title="Export Article">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
      </button>
      <button id="btn-settings" class="header-btn" title="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v4m0 14v4m-9-9h4m14 0h4M5.6 5.6l2.8 2.8m7.2 7.2l2.8 2.8M5.6 18.4l2.8-2.8m7.2-7.2l2.8-2.8"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Main Reading Area -->
  <main id="reader-main">
    <!-- Article Container - Where paginated content lives -->
    <article id="article-container">
      <header id="article-header">
        <h1 id="article-title"></h1>
        <div id="article-meta">
          <span id="article-byline"></span>
          <span id="article-reading-time"></span>
        </div>
      </header>

      <!-- Viewport clips the horizontal overflow -->
      <div id="content-viewport">
        <!-- Content container expands horizontally with columns -->
        <div id="article-content">
          <!-- Paginated content will be inserted here -->
        </div>
      </div>
    </article>

    <!-- Tap Zones for Navigation -->
    <div id="tap-zone-prev" class="tap-zone" title="Previous Page"></div>
    <div id="tap-zone-next" class="tap-zone" title="Next Page"></div>
  </main>

  <!-- Page Progress Bar -->
  <div id="progress-bar">
    <div id="progress-fill"></div>
  </div>

  <!-- Settings Panel -->
  <div id="settings-panel" class="hidden">
    <div id="settings-overlay"></div>
    <div id="settings-content">
      <div class="settings-header">
        <h2>Reading Settings</h2>
        <button id="btn-close-settings" class="close-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Font Family -->
      <div class="setting-group">
        <label class="setting-label">Font</label>
        <div class="setting-options font-options">
          <button class="font-btn" data-font="serif">Serif</button>
          <button class="font-btn" data-font="sans-serif">Sans</button>
          <button class="font-btn" data-font="monospace">Mono</button>
        </div>
      </div>

      <!-- Font Size -->
      <div class="setting-group">
        <label class="setting-label">Font Size</label>
        <div class="setting-slider">
          <button class="size-btn" data-action="decrease">A</button>
          <input type="range" id="font-size-slider" min="14" max="32" value="18" step="1">
          <button class="size-btn size-btn-large" data-action="increase">A</button>
          <span id="font-size-value">18px</span>
        </div>
      </div>

      <!-- Line Height -->
      <div class="setting-group">
        <label class="setting-label">Line Spacing</label>
        <div class="setting-slider">
          <input type="range" id="line-height-slider" min="1.4" max="2.2" value="1.8" step="0.1">
          <span id="line-height-value">1.8</span>
        </div>
      </div>

      <!-- Page Width -->
      <div class="setting-group">
        <label class="setting-label">Page Width</label>
        <div class="setting-slider">
          <input type="range" id="page-width-slider" min="400" max="900" value="680" step="20">
          <span id="page-width-value">680px</span>
        </div>
      </div>

      <!-- Theme Selection -->
      <div class="setting-group">
        <label class="setting-label">Theme</label>
        <div class="setting-options theme-options">
          <button class="theme-btn" data-theme="light" title="Light">
            <span class="theme-preview theme-light"></span>
          </button>
          <button class="theme-btn" data-theme="sepia" title="Sepia">
            <span class="theme-preview theme-sepia"></span>
          </button>
          <button class="theme-btn" data-theme="dark" title="Dark">
            <span class="theme-preview theme-dark"></span>
          </button>
          <button class="theme-btn" data-theme="eink" title="E-ink">
            <span class="theme-preview theme-eink"></span>
          </button>
        </div>
      </div>

      <!-- E-ink Optimizations -->
      <div class="setting-group">
        <label class="setting-label">E-ink Options</label>
        <div class="setting-toggles">
          <label class="toggle-label">
            <input type="checkbox" id="toggle-bold" class="toggle-input">
            <span class="toggle-text">Bold text</span>
          </label>
          <label class="toggle-label">
            <input type="checkbox" id="toggle-justify" class="toggle-input">
            <span class="toggle-text">Justify text</span>
          </label>
          <label class="toggle-label">
            <input type="checkbox" id="toggle-grayscale" class="toggle-input">
            <span class="toggle-text">Force grayscale</span>
          </label>
          <label class="toggle-label">
            <input type="checkbox" id="toggle-no-images" class="toggle-input">
            <span class="toggle-text">Hide images</span>
          </label>
        </div>
      </div>

      <!-- Behavior Options -->
      <div class="setting-group">
        <label class="setting-label">Behavior</label>
        <div class="setting-toggles">
          <label class="toggle-label">
            <input type="checkbox" id="toggle-listing-mode" class="toggle-input" checked>
            <span class="toggle-text">Show TOC on homepages</span>
          </label>
        </div>
        <p class="setting-hint">When enabled, non-article pages show a clean list of links</p>
      </div>

      <!-- Safe Area (for browser address bar) -->
      <div class="setting-group">
        <label class="setting-label">Bottom Safe Area</label>
        <div class="setting-slider">
          <input type="range" id="safe-area-slider" min="0" max="80" value="0" step="4">
          <span id="safe-area-value">0px</span>
        </div>
        <p class="setting-hint">Adjust if browser address bar overlaps content</p>
      </div>

      <!-- Debug: Pagination Fixes (for testing) -->
      <div class="setting-group">
        <label class="setting-label">TOC Pagination Fixes</label>
        <div class="setting-toggles">
          <label class="toggle-label">
            <input type="checkbox" id="debug-zero-ul" class="toggle-input">
            <span class="toggle-text">1. Zero all ul/li styles</span>
          </label>
          <label class="toggle-label">
            <input type="checkbox" id="debug-force-listing" class="toggle-input">
            <span class="toggle-text">2. Force listing !important</span>
          </label>
          <label class="toggle-label" style="opacity:0.5;">
            <input type="checkbox" id="debug-round-pixels" class="toggle-input" checked disabled>
            <span class="toggle-text">3. Round pixel values (always on)</span>
          </label>
          <label class="toggle-label">
            <input type="checkbox" id="debug-calc-width" class="toggle-input">
            <span class="toggle-text">4. Use calculated width</span>
          </label>
          <label class="toggle-label">
            <input type="checkbox" id="debug-int-column" class="toggle-input">
            <span class="toggle-text">5. Integer column width</span>
          </label>
        </div>
        <p class="setting-hint">Toggle fixes and tap Recalculate below</p>
        <button id="btn-debug-recalc" class="btn-primary" style="margin-top:10px;width:100%;">Recalculate Pagination</button>
        <div id="debug-info" style="margin-top:10px;font-size:11px;font-family:monospace;background:#f0f0f0;padding:8px;border-radius:4px;color:#333;"></div>
      </div>

      <!-- Support footer -->
      <div class="settings-footer">
        <a href="https://ko-fi.com/jkourelis" target="_blank" rel="noopener noreferrer" class="support-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.2-1.756.205-.656.004-1.31-.025-1.966-.022-.699.004-1.556-.06-2.095-.58-.475-.458-.54-1.174-.605-1.793l-.731-7.013-.322-3.094c-.037-.351-.286-.695-.678-.678-.336.015-.718.3-.678.679l.228 2.185.949 9.112c.147 1.344 1.174 2.068 2.446 2.272.742.12 1.503.144 2.257.156.966.016 1.942.053 2.892-.122 1.408-.258 2.465-1.198 2.616-2.657.34-3.332.683-6.663 1.024-9.995l.215-2.087a.484.484 0 01.39-.426c.402-.078.787-.212 1.074-.518.455-.488.546-1.124.385-1.766zm-1.478.772c-.145.137-.363.201-.578.233-2.416.359-4.866.54-7.308.46-1.748-.06-3.477-.254-5.207-.498-.17-.024-.353-.055-.47-.18-.22-.236-.111-.71-.054-.995.052-.26.152-.609.463-.646.484-.057 1.046.148 1.526.22.577.088 1.156.159 1.737.212 2.48.226 5.002.19 7.472-.14.45-.06.899-.13 1.345-.21.399-.072.84-.206 1.08.206.166.281.188.657.162.974a.544.544 0 01-.169.364z"/>
          </svg>
          Support InkPages
        </a>
      </div>
    </div>
  </div>

  <!-- Error/Fallback State -->
  <div id="error-container" class="hidden">
    <div class="error-content">
      <h2>Unable to Extract Article</h2>
      <p id="error-message">This page doesn't appear to contain a readable article.</p>
      <p class="error-source">Source: <a id="error-source-link" href="#" target="_blank"></a></p>
      <button id="btn-close-reader" class="btn-primary">Close Reader</button>
    </div>
  </div>

  <!-- Loading State -->
  <div id="loading-container">
    <div class="loading-spinner"></div>
    <p>Extracting article...</p>
  </div>

  <script src="reader.js"></script>
</body>
</html>
